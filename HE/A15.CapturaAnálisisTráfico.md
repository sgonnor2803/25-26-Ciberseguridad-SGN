<h1 align="center">A15. Captura y análisis de tráfico</h1>

![Imagen Presentación](https://github.com/sgonnor2803/25-26-Ciberseguridad-SGN/blob/master/HE/images/bannerPortada.png)

***Fecha:*** 11 de febrero de 2026
<br>***Autor***: Sergio González

---
## Índice

1. ***[Introducción](#1-introducción)***
2. ***[Objetivos del proyecto](#2-objetivos-del-proyecto)***
3. ***[Herramientas y entorno de trabajo](#3-herramientas-y-entorno-de-trabajo)***
4. ***[POC 1 – Obtención de IP mediante llamada de Telegram (STUN)](#4-poc-1--obtención-de-ip-mediante-llamada-de-telegram-stun)***
5. ***[POC 2 – Obtención de credenciales en autenticación web](#5-poc-2--obtención-de-credenciales-en-autenticación-web)***
6. ***[POC 3 – Obtención de credenciales de dispositivos de red](#6-poc-3--obtención-de-credenciales-de-dispositivos-de-red)***
7. ***[POC 4 – Captura de credenciales en TELNET](#7-poc-4--captura-de-credenciales-en-telnet)***
8. ***[Conclusiones](#8-conclusiones)***

---
## 1. ***Introducción***

Hoy en día gran parte de nuestra actividad se realiza a través de internet sin que siempre se tenga en cuenta cómo viajan realmente los datos por la red. Aunque muchas comunicaciones ya están cifradas, todavía existen servicios y protocolos que transmiten información sin protección.

En este proyecto se realizan varias pruebas de concepto (POC) para demostrar cómo es posible capturar y analizar tráfico de red utilizando Wireshark, y cómo un atacante podría obtener información sensible cuando se usan configuraciones inseguras o protocolos no cifrados.

Todas las pruebas se han llevado a cabo en un entorno controlado y con fines educativos, con el objetivo de concienciar sobre la importancia de aplicar medidas de seguridad en las redes.

---
## 2. ***Objetivos del proyecto***

El objetivo principal de este proyecto es aprender a capturar y analizar tráfico de red para identificar información sensible que se transmite sin cifrar o mediante protocolos inseguros.

De forma más concreta, los objetivos son:

- Comprender cómo funciona la captura de paquetes en una red.
- Analizar tráfico generado por diferentes servicios y protocolos.
- Obtener direcciones IP reales a través de llamadas P2P.
- Capturar credenciales en comunicaciones web sin cifrado.
- Interceptar usuarios y contraseñas de dispositivos de red.
- Analizar conexiones remotas mediante TELNET.
- Valorar los riesgos de seguridad derivados del uso de protocolos inseguros.

Con estas prácticas se busca adquirir una visión real de cómo un atacante puede aprovechar una mala configuración o la falta de cifrado en una red.

---
## 3. ***Herramientas y entorno de trabajo***

Para realizar los POCs de este proyecto utilicé las siguientes herramientas y configuraciones:

- **Sistema operativo:** Kali Linux 2026, con todo actualizado y listo para pruebas de seguridad en un laboratorio controlado.  
- **Wireshark:** la herramienta principal para capturar y analizar tráfico de red. La usé para todos los POCs: HTTP, TELNET y STUN.  
- **Navegador web:** Firefox, para acceder a páginas de prueba y al panel web del router de casa.  
- **Router doméstico:** accesible por HTTP (`192.168.8.1`), usado en el POC 3 para analizar cómo se transmiten las credenciales en la red local.  
- **TELNET:** habilitado en Kali mediante `telnetd` e `inetd` para el POC 4, con usuario de prueba `test` y contraseña `test123`.  
- **Conexión de red:** Wi‑Fi para el router y loopback (`127.0.0.1`) para TELNET, dependiendo del POC.

> Todas las pruebas se hicieron en un entorno controlado, usando solo mis propios dispositivos y con consentimiento en los casos necesarios, siguiendo siempre principios de hacking ético.

---
## 4. ***POC 1 – Obtención de IP mediante llamada de Telegram (STUN)***

En esta prueba se demuestra cómo es posible obtener la dirección IP pública de un usuario durante una llamada de Telegram cuando la opción Peer-to-Peer (P2P) está habilitada. Telegram utiliza el protocolo STUN (Session Traversal Utilities for NAT) para establecer este tipo de conexiones directas, lo que permite que los clientes conozcan su IP pública incluso si se encuentran detrás de un NAT.

Mediante la captura y análisis del tráfico STUN con Wireshark, es posible identificar la dirección IP del interlocutor.

---
### Procedimiento
---

1. Se abrió Wireshark y se seleccionó la interfaz cableada.
2. Se inició la captura de tráfico.
3. Se realizó una llamada desde Telegram al contacto de prueba.
4. Se mantuvo la llamada durante 15–20 segundos para generar tráfico.
5. Se finalizó la llamada y se detuvo la captura.
6. Se aplicó el filtro de visualización:

```
stun
```

7. Se seleccionó un paquete STUN y se inspeccionó el campo **XOR-PEER-ADDRESS** para obtener la IP del interlocutor.

```
Message Type: 0x0017 (Data Indication)
XOR-PEER-ADDRESS: 92.187.153.68:53737
```

La IP `92.187.153.68` corresponde a la dirección pública del contacto de prueba, y como no utiliza VPN, es su IP real.

---
### Evidencias
---

- Captura de Wireshark mostrando paquetes STUN.

<img width="1502" height="399" alt="image" src="https://github.com/user-attachments/assets/866ff698-1152-4cf8-b5e5-d012e4e90d20" />

- Filtro `stun` aplicado.

<img width="1501" height="52" alt="image" src="https://github.com/user-attachments/assets/4de3a2a9-abd0-417a-93c0-9131137ab56d" />

- Paquete con **XOR-PEER-ADDRESS** visible.

<img width="1017" height="372" alt="image" src="https://github.com/user-attachments/assets/ec802919-2173-4622-b1be-c7fc05193819" />

- Pantalla de la llamada activa en Telegram.

<img width="796" height="619" alt="image" src="https://github.com/user-attachments/assets/f2bd5645-d5fa-4be2-8608-3d72d1662a18" />

---
### Conclusión
---

Esta prueba demuestra que, si las llamadas P2P están habilitadas, es posible obtener la IP pública del interlocutor simplemente analizando el tráfico STUN generado durante la llamada. Esto evidencia un riesgo para la privacidad, ya que permite conocer la ubicación aproximada del usuario o su proveedor de red.

---
## 5. ***POC 2 – Obtención de credenciales en autenticación web***

En este POC se analiza cómo viajan las credenciales de un usuario cuando se autentica en una página web, comparando una comunicación sin cifrado (HTTP) con una cifrada (HTTPS). El objetivo es comprobar de forma práctica cómo un atacante puede interceptar usuarios y contraseñas cuando no se utiliza un canal seguro, y qué ocurre cuando la comunicación está protegida mediante cifrado TLS.

Para ello se han realizado dos pruebas: una sobre una web que funciona sin HTTPS y otra sobre una web con HTTPS, capturando el tráfico con Wireshark y analizando los paquetes generados durante el proceso de autenticación.

---
### 5.1. ***Captura de usuario y contraseña en una web sin HTTPS***
---

En esta prueba se demuestra cómo es posible obtener las credenciales de un usuario cuando una página web utiliza el protocolo HTTP sin cifrado. Al no existir ningún tipo de protección en la comunicación, toda la información viaja en texto plano por la red y puede ser interceptada por un tercero mediante la captura de paquetes.

---
#### Procedimiento
---

1. Se inició Wireshark en Kali Linux y se seleccionó la interfaz de red cableada.
2. Se comenzó la captura de tráfico.
3. Desde el navegador se accedió a la página de login vulnerable.
4. Se introdujeron las credenciales:
   - Usuario: `test`
   - Contraseña: `test123`
5. Se envió el formulario de autenticación.
6. Se detuvo la captura en Wireshark.
7. Se aplicó el siguiente filtro de visualización:

```
http
```

8. Entre los paquetes mostrados se localizó la petición correspondiente al envío del formulario de autenticación (método POST).
9. Se seleccionó dicho paquete y se utilizó la opción **HTML Form URL Encoded: application/x-www-form-urlencoded** para ver el contenido completo de la comunicación.

---
#### Resultados
---

En el paquete capturado se pudo observar la siguiente información:

```
POST /index.php?r=site/login HTTP/1.1
Content-Type: application/x-www-form-urlencoded

LoginForm[username]=test
LoginForm[password]=test123
```

Las credenciales aparecen en texto plano dentro del cuerpo de la petición HTTP, lo que demuestra que cualquier atacante conectado a la misma red podría obtenerlas fácilmente.

---
#### Evidencias
---

- Captura de Wireshark mostrando el paquete POST.

<img width="1507" height="197" alt="image" src="https://github.com/user-attachments/assets/f9c3380d-c393-4ab6-b7fa-bfb59c5f4263" />

- Filtro `http` aplicado.

<img width="1505" height="142" alt="image" src="https://github.com/user-attachments/assets/8e32d015-fa70-4576-b0c7-7a1639bd4c61" />

- Ventana **HTML Form URL Encoded: application/x-www-form-urlencoded** con las credenciales visibles.

<img width="1027" height="200" alt="image" src="https://github.com/user-attachments/assets/c985f9b1-a64b-4c5a-99ed-31921a113c37" />

- Formulario de autenticación de la página web.

<img width="958" height="738" alt="image" src="https://github.com/user-attachments/assets/9b27a47f-1ba5-49c7-aafa-51abf295a1db" />

---
#### Conclusión
---

Esta prueba confirma que el uso de HTTP sin cifrado supone un grave riesgo para la seguridad, ya que permite la interceptación directa de usuarios y contraseñas. La única forma de evitar este tipo de ataques es utilizando HTTPS con cifrado TLS en todas las comunicaciones.

---
### 5.2. ***Análisis de una autenticación mediante HTTPS***
---

En este apartado se analiza qué ocurre cuando se intenta interceptar una comunicación web que utiliza HTTPS. A diferencia del protocolo HTTP, HTTPS emplea cifrado mediante TLS, lo que impide que un atacante pueda leer el contenido real de los paquetes capturados.

---
#### Procedimiento
---

1. Se inició una nueva captura de tráfico en Wireshark.
2. Se accedió desde el navegador a una página web que utiliza HTTPS.
3. Se generó tráfico accediendo a la página y escribiendo datos en el formulario.
4. Se detuvo la captura.
5. Se aplicó el filtro:

```
tls
```

6. Se seleccionó uno de los paquetes capturados y se utilizó la opción **Transport Layer Security** para analizar la comunicación.

---
#### Resultados
---

En lugar de mostrar el contenido del formulario, Wireshark indica que el tráfico está cifrado mediante **TLSv1.3**. En el campo de información aparecen mensajes como:

```
TLSv1.3 Application Data, Application Data
```

Al analizar el paquete, los datos se muestran como:

```
Encrypted Application Data
```

Esto significa que, aunque se capture el tráfico, no es posible ver el usuario ni la contraseña, ya que la información viaja cifrada.

---
#### Evidencias
---

- Captura de Wireshark mostrando tráfico TLSv1.3.

<img width="1506" height="319" alt="image" src="https://github.com/user-attachments/assets/f170aced-f1e1-48a0-801f-a86a6f15ad69" />

- Vista de **Transport Layer Security** sin datos legibles.

<img width="1017" height="331" alt="image" src="https://github.com/user-attachments/assets/551e2a62-4ff6-4e67-b7ce-9ad9c70340e9" />

---
#### Conclusión
---

Este ejercicio demuestra la diferencia entre una comunicación sin cifrar y una cifrada. Mientras que en HTTP las credenciales se pueden leer directamente, en HTTPS el uso de TLS protege la información, evitando que un atacante pueda obtener datos sensibles aunque intercepte el tráfico.

---
## 6. ***POC 3 – Obtención de credenciales de dispositivos de red***

En esta prueba se analiza el proceso de autenticación de un router accesible desde la red local mediante una interfaz web. El objetivo es comprobar si las credenciales del administrador se transmiten en texto plano o si el dispositivo aplica algún tipo de protección, aun utilizando el protocolo HTTP.

---
### Procedimiento
---

1. Se inició una captura de tráfico en Wireshark seleccionando la interfaz Wi‑Fi.
2. Desde el navegador se accedió a la dirección `http://192.168.8.1`.
3. Se introdujeron las credenciales de acceso.
4. Se inició sesión en el panel de administración.
5. Se detuvo la captura.
6. Se aplicó el filtro:

```
http
```

7. Se localizó la petición POST correspondiente al login:

```
POST /api/user/authentication_login HTTP/1.1
```

8. Se analizó el contenido mediante **HTML Form URL Encoded: application/x-www-form-urlencoded**.

---
### Resultados
---

En lugar de enviar el usuario y la contraseña en texto plano, el router transmite una estructura codificada en formato XML, que incluye campos como:

```
<clientproof>9e561bc18b3b9b71335f1c896d01f56fec54b170e3420edc2087eead14e593d7</clientproof>
<finalnonce>b5f7a9fd616f1a876b5ae9c03f4950cbb0f986e26ad755646aee652ba2553fcea</finalnonce>
```

Estos valores corresponden a un mecanismo de autenticación basado en pruebas criptográficas, por lo que **la contraseña real no viaja en claro**, aunque la conexión se realice por HTTP.

---
### Evidencias
---

- Captura de Wireshark mostrando la petición POST.

<img width="1451" height="349" alt="image" src="https://github.com/user-attachments/assets/0d2edee8-4dcd-40cd-909b-0e15a0872720" />

- Filtro `http` aplicado.

<img width="1450" height="64" alt="image" src="https://github.com/user-attachments/assets/b8753bc5-64bb-40e2-a9f1-bb4092dc76b0" />

- Vista **HTML Form URL Encoded: application/x-www-form-urlencoded** con los campos cifrados.

<img width="1586" height="200" alt="image" src="https://github.com/user-attachments/assets/b39afa6f-898f-4a0e-8b27-e8092ec4aced" />

- Pantalla del login del router.

<img width="1393" height="1020" alt="image" src="https://github.com/user-attachments/assets/6b2124b5-2ea9-4b61-aa57-6e3407ec6ea2" />

---
### Conclusión
---

Aunque el router utiliza HTTP, implementa un sistema de autenticación que evita el envío directo de la contraseña. Esto demuestra que no todos los dispositivos que usan HTTP transmiten credenciales en claro, aunque sigue siendo recomendable utilizar HTTPS para evitar otros ataques como manipulación de tráfico o secuestro de sesión.

---
## 7. ***POC 4 – Captura de credenciales en TELNET***

En esta prueba se analiza la transmisión de credenciales mediante el protocolo TELNET. El objetivo es comprobar cómo se envían los datos en texto plano, y cómo un atacante podría capturarlos fácilmente utilizando Wireshark.

---
### Procedimiento
---

1. Se habilitó el servicio TELNET en Kali Linux usando `telnetd` e `inetd`.
2. Se creó un usuario de prueba con las credenciales:
   - Usuario: `test`
   - Contraseña: `test123`
3. Se abrió Wireshark y se seleccionó la interfaz **loopback (lo)** para capturar el tráfico local.
4. Se aplicó el filtro de visualización:

```
telnet
```

5. Se inició la conexión TELNET hacia `127.0.0.1`:

```bash
telnet 127.0.0.1
```

6. Se introdujeron las credenciales de acceso y se inició sesión.
7. Se detuvo la captura en Wireshark.
8. Se seleccionó un paquete TELNET y se utilizó:

```
Follow → TCP Stream
```

para reconstruir toda la sesión.

---
### Resultados
---

Al analizar el flujo TCP, Wireshark muestra la sesión completa en texto plano. Cada tecla escrita se envía en paquetes separados, pero el TCP Stream permite reconstruir claramente el login y la contraseña.

Fragmento del TCP Stream capturado:

```
H4cker login:
t
t
e
e
s
s
t
t

Contrase..a:
test123
```

Esto demuestra que **TELNET transmite carácter a carácter en claro**, permitiendo recuperar fácilmente las credenciales mediante una simple captura de tráfico.

---
### Evidencias
---

- Captura de Wireshark con filtro telnet.

<img width="1263" height="52" alt="image" src="https://github.com/user-attachments/assets/1ebbb953-afdb-475d-b096-8fd83677386f" />

- TCP Stream mostrando el usuario y la contraseña en texto plano.

<img width="1276" height="879" alt="image" src="https://github.com/user-attachments/assets/1032d1b4-84af-4259-9dc7-d240de8c7402" />

- Pantalla de la terminal con sesión TELNET iniciada.

<img width="1046" height="380" alt="image" src="https://github.com/user-attachments/assets/db7c48bc-cd00-4ca2-a5db-1765d50173a9" />

---
### Conclusión
---

TELNET es un protocolo totalmente inseguro, ya que envía todas las credenciales y comandos en texto plano. En esta prueba se pudo comprobar cómo un atacante puede recuperar usuario y contraseña con Wireshark sin necesidad de romper ninguna contraseña. Por este motivo, se recomienda utilizar **SSH** u otros protocolos seguros que cifren la comunicación.

---
## 8. ***Conclusiones***

Después de realizar todos los POCs, se pueden sacar varias conclusiones importantes.  

Las conexiones sin cifrado, como HTTP o TELNET, muestran que los datos viajan en texto plano y pueden ser capturados fácilmente. En cambio, HTTPS y TLS protegen la información y evitan que un atacante lea las credenciales.  

También se comprobó que las llamadas P2P de Telegram pueden revelar la IP pública del usuario a través de STUN, lo que supone un riesgo para la privacidad. Por otro lado, algunos routers usan mecanismos de autenticación que dificultan la captura de contraseñas aunque usen HTTP, pero siempre es recomendable usar conexiones seguras.  

En resumen, estas prácticas muestran cómo pequeños descuidos en la configuración o en el uso de protocolos inseguros pueden comprometer información sensible y por qué es importante aplicar buenas prácticas de seguridad.
