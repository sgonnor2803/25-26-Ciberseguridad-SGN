<h1 align="center">A2.1. Windows Forensic Analisys (Basic Registry Analysis)</h1>

![Imagen Presentación](https://github.com/sgonnor2803/25-26-Ciberseguridad-SGN/blob/master/AFI/images/bannerPortada.png)

***Fecha:*** 12 de diciembre de 2025
<br>***Autor***: Sergio González

---

## Índice

1. ***[Introducción](#1-introducción)***
2. ***[Metodología del análisis forense](#2-metodología-del-análisis-forense)***
3. ***[Evidencias disponibles](#3-evidencias-disponibles)***
4. ***[Análisis del disco](#4-análisis-del-disco)***
5. ***[Hallazgos principales](#5-hallazgos-principales)***
6. ***[Conclusión](#6-conclusión)***

---
## 1. ***Introducción***

En este proyecto se realiza un análisis forense digital sobre una imagen de disco de un sistema Windows proporcionada como evidencia. El objetivo principal es examinar el contenido del disco y obtener información relevante utilizando técnicas básicas de informática forense.

La evidencia entregada consiste en un archivo con extensión `.ad1`, que corresponde a una imagen forense del disco. Este tipo de formato permite trabajar sobre una copia exacta del sistema original sin modificar los datos, algo fundamental en cualquier análisis forense.

Para llevar a cabo el análisis se ha utilizado la herramienta **FTK Imager**, que permite abrir, explorar y examinar el contenido de imágenes forenses de forma segura. A lo largo del proyecto se describen los pasos seguidos durante el análisis, las evidencias encontradas y los principales hallazgos obtenidos a partir del disco.

---
## 2. ***Metodología del análisis forense***

Para la realización de este proyecto se ha seguido una metodología similar a la utilizada en trabajos anteriores, basada en las fases generales del análisis forense descritas en las normas ISO 27037, 27041, 27042 y 27043. El objetivo principal ha sido analizar la evidencia proporcionada sin modificar en ningún momento los datos originales y manteniendo la integridad de la información.

En este caso, la evidencia disponible es una imagen de disco de Windows en formato `.ad1`. Al tratarse ya de una imagen forense, no ha sido necesario realizar tareas de adquisición, sino que el trabajo se ha centrado directamente en el análisis de dicha imagen. Para ello, se ha utilizado la herramienta **FTK Imager**, abriendo la imagen siempre en modo de solo lectura para evitar cualquier alteración del contenido.

El análisis se ha realizado sobre la copia proporcionada, respetando en todo momento la cadena de custodia. Durante el proceso se ha revisado la estructura del sistema de archivos, los directorios principales del sistema y la información relacionada con los usuarios y archivos almacenados en el disco.

Todo el proceso ha sido documentado, anotando los pasos realizados y los hallazgos obtenidos, con el fin de mantener una metodología clara y repetible, acorde a los principios básicos del análisis forense digital.

---
## 3. ***Evidencias disponibles***

Para el análisis forense se ha contado únicamente con una evidencia digital. Esta evidencia corresponde a una imagen de disco de un sistema Windows, proporcionada para su análisis.

La evidencia disponible es la siguiente:

- **Imagen de disco**
  - Formato: `.ad1`
  - Tipo: Imagen forense de disco
  - Sistema operativo: Windows
  - Herramienta utilizada para el análisis: **FTK Imager**

La imagen de disco se ha analizado siempre en modo de solo lectura para evitar cualquier modificación de los datos originales. No se dispone de otras evidencias adicionales, por lo que el análisis se basa únicamente en el contenido de esta imagen.

---
## 4. ***Análisis del disco***

La imagen de disco en formato `.ad1` se ha cargado en la herramienta FTK Imager en modo de solo lectura. Una vez abierta la imagen, se ha revisado la estructura de directorios disponible para determinar el contenido accesible del sistema.

Durante la exploración del disco se ha observado que únicamente se encuentra presente la carpeta `Windows`. No se han localizado otras rutas habituales como `Users`, `Program Files` o `Documents`, por lo que el análisis se ha centrado exclusivamente en el contenido disponible dentro de dicha carpeta.

### Carpeta Windows

Dentro de la carpeta `Windows` se han identificado las siguientes ubicaciones relevantes para el análisis forense:

- **Prefetch**  
  Esta carpeta contiene archivos que registra Windows cuando se ejecutan aplicaciones. Su análisis permite obtener información sobre la ejecución de programas, como nombres de aplicaciones y posibles fechas de uso.

- **System32\\config**  
  En esta ubicación se encuentran los archivos del registro de Windows. Estos archivos almacenan información importante sobre la configuración del sistema, el hardware y el software instalado.

- **System32\\winevt**  
  Esta carpeta contiene los registros de eventos de Windows. Los archivos de eventos permiten analizar la actividad del sistema, como arranques, apagados, errores y otros sucesos relevantes.

El análisis se ha limitado a la revisión de estas carpetas, ya que no se dispone de más información en la imagen de disco proporcionada. No se han realizado modificaciones sobre la evidencia en ningún momento, trabajando siempre sobre la imagen en modo de solo lectura.

---
## 5. ***Hallazgos principales***

En este apartado se presentan los hallazgos clave obtenidos del análisis forense del sistema Windows, incluyendo archivos Prefetch, registros de eventos (SYSTEM, SECURITY, APPLICATION) y evidencias en AppData. Estos artefactos permiten reconstruir la actividad del sistema y evaluar posibles riesgos de seguridad.

---
### 5.1. ***Evidencias Prefetch***
---

Los archivos Prefetch de Windows permiten saber qué programas se han ejecutado en el sistema y cuándo, por lo que son una evidencia muy importante en un análisis forense. En este caso, el análisis de estos archivos confirma de forma clara la actividad real que tuvo el sistema.

***Hallazgos principales:***

- ***Ejecución de herramientas del sistema***
Se ha comprobado la ejecución de programas como `CMD.EXE`, `REGEDIT.EXE` y `RUNDLL32.EXE`. Estas herramientas permiten acceder a configuraciones internas y al registro de Windows. El hecho de que existan archivos Prefetch asociados confirma que fueron ejecutadas realmente en el sistema.

- ***Ejecución de software fuera de las rutas normales de Windows***
Aparece la ejecución de `KMSAuto Net`, localizado fuera de los directorios habituales del sistema. Los archivos Prefetch indican que este programa se ejecutó varias veces, lo que implica que el sistema fue modificado de forma persistente.

- ***Creación de archivos temporales durante la ejecución de procesos***
Se detectaron archivos temporales con el formato `tw-*.tmp`, que se generan automáticamente cuando ciertos programas se ejecutan. Estos archivos confirman que hubo actividad a nivel de sistema y que se ejecutaron procesos que dejaron rastros temporales.

Las evidencias Prefetch demuestran que el sistema estuvo en uso activo y que se ejecutaron programas con capacidad para modificar configuraciones y archivos importantes de Windows. Esta información sirve como base para relacionar estas ejecuciones con el resto de evidencias del análisis.

<img width="1287" height="643" alt="image" src="https://github.com/user-attachments/assets/69862107-22ec-42b0-a8a2-196ed8062ca8" />

> Parte de ejemplo del reporte html sobre el Prefetch

### 5.2. ***Registro de eventos (Logs)***
---

Para este apartado se han analizado los principales registros de eventos de Windows, concretamente los archivos ***System, Security y Application***, ubicados en el directorio `Windows\System32\config`, junto con otros logs adicionales como los de ***Windows Update, PowerShell y TaskScheduler***. Estos registros permiten comprobar qué ha ocurrido realmente en el sistema y validar la actividad detectada en otros artefactos forenses.

***Hallazgos principales:***

- ***Uso real del sistema y del usuario***

En el registro ***Security*** aparecen eventos que confirman que el sistema estuvo en uso durante el periodo analizado. Se observan inicios de sesión correctos (evento ***4624***) y eventos donde se asignan privilegios elevados a la cuenta ***SYSTEM*** (evento ***4672***), lo que indica la ejecución de procesos con el mayor nivel de permisos en Windows.  
Además, el usuario `testx` realiza acciones como la consulta de grupos locales (evento ***4798***), lo que demuestra una interacción directa y consciente con el sistema.

- ***Accesos repetidos a credenciales del sistema***

Se detectan numerosos eventos ***5379***, relacionados con el acceso al Administrador de credenciales de Windows. Estos eventos aparecen repetidos en intervalos de tiempo muy cortos, lo que indica que las credenciales fueron consultadas de forma intensiva y no como una acción puntual o aislada del usuario.

- ***Ejecución de PowerShell***

En los logs de ***PowerShell*** se registran varias ejecuciones durante el periodo analizado, con inicios y cierres correctos del motor. Esto confirma que PowerShell fue utilizado activamente en el sistema.  
Estas ejecuciones coinciden temporalmente con otros eventos relevantes, como accesos a credenciales y procesos con privilegios elevados, lo que permite integrarlas dentro de la misma línea temporal forense.

- ***Actividad normal del sistema operativo***

En el log ***System*** se identifican eventos habituales del funcionamiento de Windows, como:

- Arranques y apagados normales del sistema.
- Instalación y gestión de servicios, incluyendo herramientas de seguridad.
- Actividad relacionada con la red y las actualizaciones de Windows.
- Configuraciones de seguridad poco restrictivas, propias de un entorno de laboratorio o de prácticas.

Todo esto indica que el sistema estaba operativo y en uso, descartando que se trate de un sistema apagado o inactivo durante el periodo analizado.

- ***Estado del sistema y licencias***

En el log ***Application*** aparecen numerosos eventos relacionados con errores y comprobaciones de activación de licencias por volumen. Estos eventos confirman cambios y verificaciones frecuentes del estado del sistema, coherentes con lo observado previamente en otros artefactos analizados.

En conjunto, los registros de eventos confirman que el sistema estuvo activo, que se ejecutaron procesos con privilegios elevados y que se accedió de forma repetida a componentes sensibles del sistema, como las credenciales. Los eventos están correctamente correlacionados en el tiempo y no presentan indicios de manipulación, aportando evidencias sólidas para el análisis global del caso.

### 5.3. ***Evidencias AppData***
---

El análisis del directorio ***AppData*** se ha realizado a partir del contenido localizado en el perfil del sistema (`systemprofile`), ya que es uno de los pocos perfiles disponibles en la imagen de disco. Este directorio es especialmente relevante en análisis forense porque suele almacenar datos temporales, caché, configuraciones y archivos generados por aplicaciones y procesos que se ejecutan en segundo plano.

***Hallazgos principales:***

- ***Presencia de archivos temporales y de trabajo***

Dentro de AppData se han identificado múltiples archivos temporales, principalmente con extensiones como `.tmp` y nombres generados automáticamente. Este tipo de archivos se crean cuando una aplicación o proceso necesita trabajar con datos de forma temporal, ya sea durante su ejecución o como parte de tareas internas del sistema.

Estos archivos no se crean de forma manual por el usuario, sino como resultado directo de la ejecución de procesos en el sistema, lo que confirma actividad real y continuada.

- ***Logs CLR en `Local\Microsoft\CLR_v4.0\UsageLogs`***

Se han encontrado registros de ejecución de procesos como:

- `NGenTask.exe.log`
- `powershell.exe.log`
- `RemoteFXvGPUDisablement.exe.log`
- `taskhostw.exe.log`
- `tzsync.exe.log`

Estos logs muestran que se ejecutaron ensamblados .NET bajo el motor CLR, incluyendo componentes de PowerShell y tareas internas del sistema. Esto refuerza que la actividad del sistema fue real y que muchos procesos se ejecutaron automáticamente con privilegios elevados, coincidiendo con los accesos a archivos sensibles y la generación de archivos temporales.

- ***Actividad en contexto de privilegios elevados***

Al encontrarse estos archivos y logs dentro del perfil `systemprofile`, se puede afirmar que fueron generados por procesos que se ejecutaron bajo la cuenta ***SYSTEM***. Esto indica que ciertas acciones no se realizaron como un usuario estándar, sino con privilegios elevados.

- ***Persistencia de archivos generados automáticamente***

Algunos de los archivos temporales y logs no fueron eliminados tras su creación, lo que sugiere que los procesos que los generaron finalizaron de forma abrupta o que no se realizó una limpieza posterior. Esto es habitual en ejecuciones automáticas, tareas del sistema o procesos que interactúan con componentes críticos del sistema operativo.

- ***Correlación con otros artefactos***

La existencia de estos archivos y logs coincide temporalmente con:
- Accesos repetidos a componentes sensibles del sistema reflejados en los logs.
- Ejecuciones de procesos con privilegios elevados.
- Actividad registrada en Prefetch y registros de eventos.

Esta correlación refuerza la idea de que los archivos y logs encontrados en AppData forman parte de la misma actividad del sistema analizada en el resto del informe.

En conjunto, las evidencias localizadas en AppData y los registros CLR confirman la ejecución de procesos en segundo plano bajo la cuenta SYSTEM y aportan información adicional sobre cómo el sistema fue utilizado internamente durante el periodo investigado.

### 5.4. ***Archivos del registro del sistema (System32\\config)***
---

Durante el análisis se revisó el directorio `Windows\\System32\\config`, donde se almacenan los principales archivos del registro de Windows, como ***SYSTEM, SECURITY, SOFTWARE y SAM***.

Estos archivos se encuentran presentes y con fechas de modificación coherentes con el periodo de actividad analizado, lo que confirma que el sistema estaba en uso y que los eventos estudiados en los registros de seguridad y sistema se corresponden con cambios reales en el sistema.

Su análisis sirve como apoyo a los hallazgos obtenidos en los logs y refuerza la validez de las evidencias forenses utilizadas en el apartado anterior.

### 5.5. ***Vulnerabilidad identificada***
---

A partir del análisis conjunto de todas las evidencias forenses obtenidas (Prefetch, registros de eventos, AppData, logs CLR y archivos del registro del sistema), se puede identificar de forma clara la vulnerabilidad explotada en el sistema.

Los hallazgos realizados encajan directamente con la vulnerabilidad ***CVE-2021-36934***, conocida como HiveNightmare o SeriousSAM.

Esta vulnerabilidad afecta a sistemas Windows en los que los archivos sensibles del registro, como ***SAM, SYSTEM y SECURITY***, tienen permisos de acceso incorrectos, permitiendo que usuarios con bajos privilegios puedan leer su contenido y obtener información crítica del sistema.

***Relación de la vulnerabilidad con las evidencias encontradas:***

- A través del análisis ***Prefetch***, se confirma la ejecución real de herramientas del sistema como `CMD.EXE`, `REGEDIT.EXE` y `RUNDLL32.EXE`, así como la ejecución repetida de software capaz de modificar configuraciones internas de Windows. Esto demuestra que se realizaron acciones activas sobre el sistema y no solo cambios pasivos.

- En los ***registros de eventos***, se observan múltiples ejecuciones de procesos con privilegios elevados (cuenta ***SYSTEM***), junto con accesos repetidos al Administrador de credenciales (eventos ***5379***). Este comportamiento es coherente con la obtención y uso de información sensible almacenada en el sistema.

- Las evidencias localizadas en ***AppData***, dentro del perfil `systemprofile`, confirman la ejecución de procesos bajo el contexto de la cuenta SYSTEM y la generación de archivos temporales asociados a dicha actividad. Además, los logs CLR ubicados en `Local\Microsoft\CLR_v4.0\UsageLogs` (como `powershell.exe.log`, `NGenTask.exe.log` o `RemoteFXvGPUDisablement.exe.log`) muestran la ejecución de ensamblados .NET bajo privilegios elevados, reforzando la idea de que se interactuó directamente con componentes internos del sistema.

- La presencia y consistencia de los archivos ***SAM, SYSTEM y SECURITY*** en el directorio `Windows\System32\config`, junto con la actividad registrada en los logs y procesos CLR, refuerza que estos archivos fueron accesibles durante el periodo analizado, condición necesaria para la explotación de esta vulnerabilidad.

La vulnerabilidad ***CVE-2021-36934*** requiere que el sistema esté en uso, que existan permisos incorrectos sobre los archivos del registro y que se ejecuten procesos capaces de acceder a dichos archivos, condiciones que quedan plenamente justificadas por las evidencias analizadas en los apartados anteriores.

Por tanto, y en base a los artefactos forenses estudiados, se concluye que la actividad observada en el sistema es compatible con la explotación de la vulnerabilidad ***CVE-2021-36934***, lo que explica el acceso a información sensible y la ejecución de procesos con privilegios elevados detectados durante el análisis.

---
## 6. ***Conclusión***

Con el análisis de la imagen de disco pudimos ver cómo se estaba usando el sistema Windows en realidad. Se ejecutaron varios programas, se accedió a credenciales y se corrieron procesos con privilegios elevados. También encontramos archivos temporales y logs en AppData, y los archivos importantes del registro (SAM, SYSTEM y SECURITY) estaban accesibles.  

Todo esto muestra que el sistema estaba activo y funcionando normalmente durante el periodo que analizamos. Además, los hallazgos confirman que se aprovechó la vulnerabilidad ***CVE-2021-36934***, lo que explica cómo se accedió a archivos sensibles y por qué hubo actividad con privilegios altos. En general, toda la evidencia encaja y nos permite cerrar el análisis con claridad.
